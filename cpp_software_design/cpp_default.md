# c++

## default キーワード

### 解説

C++における`default`キーワードは主にクラスのメンバ関数（特にコンストラクタやデストラクタ）に対して、コンパイラにデフォルトの実装を生成させるために使用されます。これは、特にコピーコンストラクタやコピー代入オペレータ、ムーブコンストラクタ、ムーブ代入オペレータでよく使われます。

### コード例

```cpp
#include <iostream>

class MyClass {
public:
    // デフォルトコンストラクタを明示的にデフォルト実装に設定
    MyClass() = default;

    // デフォルトデストラクタを明示的にデフォルト実装に設定
    ~MyClass() = default;

    // コピーコンストラクタをデフォルト実装に設定
    MyClass(const MyClass&) = default;

    // コピー代入オペレータをデフォルト実装に設定
    MyClass& operator=(const MyClass&) = default;

    // ムーブコンストラクタをデフォルト実装に設定
    MyClass(MyClass&&) = default;

    // ムーブ代入オペレータをデフォルト実装に設定
    MyClass& operator=(MyClass&&) = default;

    // その他のメンバ関数
    void display() {
        std::cout << "MyClass instance" << std::endl;
    }
};

int main() {
    MyClass obj1;           // デフォルトコンストラクタが呼ばれる
    MyClass obj2 = obj1;    // コピーコンストラクタが呼ばれる
    MyClass obj3;           // デフォルトコンストラクタが呼ばれる
    obj3 = obj1;            // コピー代入オペレータが呼ばれる

    obj1.display();
    obj2.display();
    obj3.display();

    return 0;
}

```

このコードでは、`MyClass`クラスの各種コンストラクタと代入オペレータを`default`キーワードを使用して、コンパイラのデフォルト実装に設定しています。これにより、クラスのインスタンスが作成される際にこれらのメンバ関数が自動的に生成されます。

この方法は、特に大きなクラスで標準的な動作を望む場合や、ルール・オブ・ゼロ（Rule of Zero）に従いたい場合に有用です。これにより、コードの可読性を高めるとともに、エラーの発生を防ぐことができます。

### default実装とは

C++における`default`実装とは、コンパイラによって自動的に生成されるクラスのメンバ関数のことを指します。これらのデフォルト実装は、クラスに特定のメンバ関数が明示的に定義されていない場合にコンパイラによって提供されるものです。

具体的には、以下のようなメンバ関数が`default`実装の対象となります：

1. **デフォルトコンストラクタ**：オブジェクトが引数なしで作成されたときに呼ばれます。クラスに他のコンストラクタが一つも定義されていない場合、コンパイラはデフォルトコンストラクタを生成します。
2. **デストラクタ**：オブジェクトのスコープが終了したとき、または`delete`が呼ばれたときに実行される関数です。ユーザーがデストラクタを定義しない場合、コンパイラはデフォルトデストラクタを生成します。
3. **コピーコンストラクタ**：既存のオブジェクトから新しいオブジェクトを初期化するために使用されます。これが定義されていない場合、コンパイラはメンバごとのコピーを行うデフォルトのコピーコンストラクタを生成します。
4. **コピー代入オペレータ**：一つのオブジェクトから別のオブジェクトに値をコピーするために使用されます。これが定義されていない場合、コンパイラはメンバごとのコピーを行うデフォルトのコピー代入オペレータを生成します。
5. **ムーブコンストラクタ**と**ムーブ代入オペレータ**：C++11以降で導入されたこれらの関数は、オブジェクトのリソースを効率的に移動するために使用されます。ユーザーがこれらを定義しない場合、コンパイラはデフォルトのムーブ動作を提供します。

`default`キーワードを使用することで、これらの関数を明示的にデフォルト実装に設定することができます。これは、特にコンパイラが自動的に生成する実装が適切である場合や、クラスの動作を明確に示したい場合に有用です。



### 仮想関数と純粋仮想関数

```cpp
class Document
{
    virtual ~Document() = default;
}
```

`Document`クラスのデストラクタ`~Document()`には`virtual`キーワードがついているので、このデストラクタが仮想関数であることを示しています。しかしながら、これは==純粋仮想関数ではありません==。純粋仮想関数は`=0`を使用して宣言されますが、`~Document()`デストラクタには`= default`が指定されています。

ここでのポイントは以下の通りです：

- **仮想デストラクタ**：`virtual`キーワードは、基底クラスのデストラクタが継承されるクラスによってオーバーライドされうることを意味します。これは、ポリモーフィズムを使用する場合、特に重要です。派生クラスのオブジェクトが基底クラスのポインタや参照を通じて削除されるとき、適切なデストラクタ（派生クラスのデストラクタ）が呼び出されることを保証します。
- **`= default`キーワード**：`~Document()`デストラクタに`= default`を指定することは、コンパイラにこのデストラクタのデフォルト実装を生成させることを意味します。この場合、`Document`クラスのデストラクタは特別な動作を必要としないため、コンパイラのデフォルトの振る舞いで十分とされています。

このように、`Document`クラスでは、仮想デストラクタがデフォルト実装されており、これは多態性をサポートしつつ、特別な破棄処理が必要ない場合の標準的な実装を使用することを意味します。派生クラスでは、特別なクリーンアップが必要な場合にのみデストラクタをオーバーライドする必要がありますが、そうでない場合は基底クラスのデストラクタが使用されます。これにより、派生クラスの作者は必要に応じてデストラクタを実装することができ、デストラクタの実装が不要な場合はそのまま基底クラスのデストラクタが使用されます。